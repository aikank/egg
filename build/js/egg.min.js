/*! jp.mi73.egg 2014-01-31 */
!function(a,b,c,d){"use strict";var e=function(){var e="easeInOutQuart",f=+new Date,g=6e4,h=!1;this.init=function(){function i(){requestAnimationFrame(i),j.particleMaterial.uniforms.time.value=(+new Date-f)/1e3,D.update(),j.renderer.render(j.scene,j.camera)}var j=this;this.renderer=new d.WebGLRenderer({antialias:!0}),this.renderer.setSize(a.innerWidth,a.innerHeight),this.renderer.setClearColorHex(0,1),this.renderer.shadowMapEnabled=!0,c(a).on("resize",function(){j.renderer.setSize(a.innerWidth,a.innerHeight)}),b.getElementById("canvas-frame").appendChild(this.renderer.domElement);var k=60,l=window.innerWidth/window.innerHeight,m=.1,n=1e4;this.camera=new d.PerspectiveCamera(k,l,m,n),this.camera.position=new d.Vector3(170,0,10),this.camera.up=new d.Vector3(1,0,1),this.scene=new d.Scene,this.scene.add(this.camera);var o=new d.SpotLight(16777215);o.position.set(150,150,300),o.target.position.set(0,0,0),o.castShadow=!0,this.scene.add(o);var p=new d.SpotLight(16777215);p.position.set(100,-150,300),p.target.position.set(0,0,0),p.castShadow=!0;var q=new d.SpotLight(16777215);q.position.set(150,500,300),q.target.position.set(0,0,0),q.castShadow=!0;var r=new d.SpotLight(16777215);r.position.set(100,-500,300),r.target.position.set(0,0,0),r.castShadow=!0;var s=new d.AmbientLight(1052688);this.scene.add(s);var t=new d.MeshPhongMaterial({color:16777215,specular:16777215,shininess:1e3,shading:d.SmoothShading,side:d.DoubleSide}),u=new d.PlaneGeometry(1e4,1e5,200,200);this.ground=new d.Mesh(u,t),this.ground.position.z=-40,this.ground.receiveShadow=!0,this.ground.visible=!1,this.scene.add(this.ground),this.eggPoints=[];for(var v,w,x=40,y=0;180>=y;y++)v=Math.PI*y/180,w=new d.Vector3(0,x*(.72+.08*Math.cos(v))*Math.sin(v),-x*Math.cos(v)),this.eggPoints.push(w);this.eggGeometry=new d.LatheGeometry(this.eggPoints,100),this.eggGeometry.dynamic=!0,this.eggMaterial=new d.MeshPhongMaterial({color:16756849,shininess:50,shading:d.SmoothShading,wireframe:!0}),this.egg=new d.Mesh(this.eggGeometry,this.eggMaterial),this.egg.matrixWorldNeedsUpdate=!0,this.egg.updateMatrixWorld(),this.egg.position.set(.1,.1,.1),this.egg.castShadow=!0,this.dotsPoints=new d.Object3D;var z=new d.MeshBasicMaterial({color:16777215,transparent:!1});this.scene.add(this.dotsPoints),this.particleGeometry=new d.Geometry,this.particleMaterial=new d.ShaderMaterial({vertexShader:document.getElementById("vshader").textContent,fragmentShader:document.getElementById("fshader").textContent,uniforms:{time:{type:"f",value:0},size:{type:"f",value:.13},color:{type:"c",value:new d.Color(16756849)},texture:{type:"t",value:d.ImageUtils.loadTexture("img/particle.png")}},attributes:{lifetime:{type:"f",value:[]},shift:{type:"f",value:[]}},blending:d.AdditiveBlending,transparent:!0,depthTest:!1});for(var y=0;g>y;y++){var v=2*Math.random()*Math.PI,A=x*(.72+.08*Math.cos(v))*Math.sin(v),B=Math.random()*Math.PI,C=new d.Vector3(Math.sin(B)*A,Math.cos(B)*A,-x*Math.cos(v));C.velocity={x:Math.sin(B)*A/x*5,y:Math.cos(B)*A/x*5,z:5*-Math.cos(v)},this.particleMaterial.attributes.lifetime.value.push(3+Math.random()),this.particleMaterial.attributes.shift.value.push(Math.random()),this.particleGeometry.vertices.push(C)}this.particleGeometry.verticesNeedUpdate=!0,this.particle=new d.ParticleSystem(this.particleGeometry,this.particleMaterial),this.particle.position=new d.Vector3(0,0,0),this.particle.sortParticles=!1,this.particle.visible=!1,this.scene.add(this.particle);var D=new d.TrackballControls(this.camera);D.keys=[65,83,68],D.noRotate=!1,D.noZoom=!1,D.noPan=!1,this.controls=D,i(),this.drawEggPoint=function(){var a=0,b=function(){if(a%5===0){var c=new d.SphereGeometry(.5),e=new d.Mesh(c,z);e.position=j.eggPoints[a],j.dotsPoints.add(e),j.renderer.render(j.scene,j.camera)}a++,180>=a&&requestAnimationFrame(b)};b()},this.spinCurve=function(){var a=0,b=0,c=function(){j.dotsPoints&&(j.dotsPoints.rotateZ(b),j.renderer.render(j.scene,j.camera),a++,b+=.001,requestAnimationFrame(c))};c()},this.autoPan=function(){var a=h?1200*Math.random():200*Math.random()+200,b=Math.random()*Math.PI*2,c=h?500*Math.random()-60:200*Math.random()-40;this.panTo({x:a*Math.sin(b),y:a*Math.cos(b),z:c})},this.panTo=function(a){var b,e=this,f=0,g=200,h="easeOutQuart",i={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},j=function(){f++,b=c.easing[h](0,f,0,1,g),e.camera.position=new d.Vector3(i.x*(1-b)+a.x*b,i.y*(1-b)+a.y*b,i.z*(1-b)+a.z*b),e.camera.up=new d.Vector3(0,0,1e4),g>f&&requestAnimationFrame(j)};j()},this.addEggPoints=function(){for(var a,b,c,e=new d.SphereGeometry(.5),f=new d.Mesh(e,z),g=1;6>g;g++)for(var h=0;180>=h;h++)h%5===0&&(b=g/6*2*Math.PI,c=Math.PI*h/180,a=x*(.72+.08*Math.cos(c))*Math.sin(c),f=new d.Mesh(e,z),w=new d.Vector3(a*Math.sin(b),a*Math.cos(b),-x*Math.cos(c)),f.position=w,j.dotsPoints.add(f),j.renderer.render(j.scene,j.camera))},this.fallOutPoints=function(){var a=0,b=100,d=function(){var g=c.easing[e](0,a,0,4e3,b);a!==b?(requestAnimationFrame(d),j.dotsPoints.position.z=-g,a++):f()},f=function(){j.scene.remove(j.dotsPoints),delete j.dotsPoints};j.dotsPoints&&d()},this.animateEggWire=function(){var a=2,b=100,d=function(){j.showEggWire(a),a*=2,b>=a&&setTimeout(c.proxy(d,this),300)};d()},this.showEggWire=function(a){j.scene.remove(j.egg),delete j.egg,j.eggGeometry=new d.LatheGeometry(j.eggPoints,a),j.egg=new d.Mesh(j.eggGeometry,j.eggMaterial),j.egg.matrixWorldNeedsUpdate=!0,j.egg.updateMatrixWorld(),j.egg.position.set(0,0,0),j.egg.castShadow=!0,j.scene.add(j.egg)},this.offWireframe=function(){j.egg.material.wireframe=!1},this.applyMap=function(){j.scene.remove(j.egg),delete j.egg,delete j.eggGeometry,delete j.eggMaterial,j.eggGeometry=new d.LatheGeometry(j.eggPoints,100),j.eggMaterial=new d.MeshPhongMaterial({color:16756849,shininess:50,map:d.ImageUtils.loadTexture("img/egg.jpg"),shading:d.SmoothShading}),j.egg=new d.Mesh(j.eggGeometry,j.eggMaterial),j.egg.castShadow=!0,j.scene.add(j.egg)},this.explode=function(){var a=function(){for(var b=j.particleGeometry.vertices.length;b--;){var c=j.particleGeometry.vertices[b];c.x+=c.velocity.x,c.y+=c.velocity.y,c.velocity.z-=.1,c.z+=c.velocity.z,c.z<=-39&&(c.velocity.x*=.9,c.velocity.y*=.9,c.velocity.z=.7*-c.velocity.z,c.z=-39),j.ground.position.z-=10}j.particleGeometry.verticesNeedUpdate=!0,requestAnimationFrame(a)};j.particle.visible=!0,j.egg.visible=!1,h=!0,a()},this.appearGround=function(){var a=0,b=250,d="easeOutQuart",e=function(){var f=c.easing[d](0,a,0,1,b);j.ground.position.z=-4e3+3960*f,a++,a!==b?requestAnimationFrame(e):j.ground.position.z=-40};j.ground.position.z=-4e3,j.ground.visible=!0,e()},this.move=function(){var a=0,b=function(){var c=15*a/300;j.egg.rotation.x=.1*Math.sin(Math.PI*c),j.egg.position.y=-5*Math.sin(Math.PI*c),a++,300>=a&&requestAnimationFrame(b)};b()},this.jump=function(){var a=20,b=0,c=function(){b+=a,0>=b&&(a=.7*-a,b=0),j.egg.position.z=b,a-=.5,j.renderer.render(j.scene,j.camera),requestAnimationFrame(c)};c()},this.bar=0,this.dancing=!0,this.startDancing=function(){this.dancing=!0,this.dance()},this.stopDancing=function(){this.dancing=!1},this.dance=function(){var a=0,b=160,d=3600/b,e=0,f=100,g=(j.egg.position.x>f,j.egg.position.x<-f,j.egg.position.y>f,j.egg.position.y<-f,function(){if(0===a&&j.egg.position.x<-f)return console.log("ignore"),requestAnimationFrame(h);var b=Math.sin(2*Math.PI*a/d);j.egg.position.z=6*Math.abs(b),j.egg.rotation.x=-b/5,j.egg.position.x-=1,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:g)}),h=function(){if(0===a&&j.egg.position.x>f)return console.log("ignore"),requestAnimationFrame(g);var b=Math.sin(2*Math.PI*a/d);j.egg.position.z=6*Math.abs(b),j.egg.rotation.x=b/5,j.egg.position.x+=1,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:h)},i=function(){if(0===a&&j.egg.position.y>f)return console.log("ignore"),requestAnimationFrame(k);var b=Math.sin(2*Math.PI*a/d);j.egg.position.z=6*Math.abs(b),j.egg.rotation.y=b/5,j.egg.position.y+=1,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:i)},k=function(){if(0===a&&j.egg.position.y<-f)return console.log("ignore"),requestAnimationFrame(i);var b=Math.sin(2*Math.PI*a/d);j.egg.position.z=6*Math.abs(b),j.egg.rotation.y=b/5,j.egg.position.y-=1,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:k)},l=function(){if(0===a&&j.egg.position.y>f)return console.log("ignore"),requestAnimationFrame(m);var b=c.easing.easeOutQuart(0,a,0,50,d);j.egg.position.z=0,j.egg.position.y+=b-e,j.egg.rotation.x=b-e,e=b,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:l)},m=function(){if(0===a&&j.egg.position.y<-f)return console.log("ignore"),requestAnimationFrame(l);var b=c.easing.easeOutQuart(0,a,0,50,d);j.egg.position.z=0,j.egg.position.y-=b-e,j.egg.rotation.x=-b+e,e=b,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:m)},n=function(){if(0===a&&j.egg.position.x<-f)return requestAnimationFrame(o);var b=c.easing.easeOutQuart(0,a,0,50,d);j.egg.position.z=0,j.egg.position.x-=b-e,j.egg.rotation.y=b-e,e=b,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:n)},o=function(){if(0===a&&j.egg.position.x>f)return console.log("ignore"),requestAnimationFrame(n);var b=c.easing.easeOutQuart(0,a,0,50,d);j.egg.position.z=0,j.egg.position.x+=b-e,j.egg.rotation.y=-b+e,e=b,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:o)},p=function(){var b=a/d;j.egg.rotation.x=2*Math.PI*b,j.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:p)},q=function(){var b=a/d;j.egg.rotation.x=4*Math.PI*b,j.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:q)},r=function(){var b=a/d;j.egg.rotation.x=2*-Math.PI*b,j.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:r)},s=function(){var b=a/d;j.egg.rotation.x=4*-Math.PI*b,j.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:s)},t=function(){var b=a/d;j.egg.rotation.y=2*-Math.PI*b,j.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:t)},u=function(){var b=a/d;j.egg.rotation.y=4*-Math.PI*b,j.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,j.renderer.render(j.scene,j.camera),requestAnimationFrame(a>=d?j.dance:u)},v=function(){var b=a/d,c=Math.sin(2*Math.PI*a/d);j.egg.rotation.x=c/5,j.egg.rotation.y=c/5,j.egg.rotation.z=c/5,j.egg.position.x*=1-b,j.egg.position.y*=1-b,j.egg.position.z*=1-b,a++,j.renderer.render(j.scene,j.camera),a>=d?(j.egg.position.x=0,j.egg.position.y=0,j.egg.position.z=0):requestAnimationFrame(v)},w=[g,h,i,k,l,m,n,o,p,r,q,s,t,u],x=(Math.floor(12*Math.random()),[0,0,1,1,2,3,3,2,4,4,8,8,8,8,5,5,5,5,9,9,9,9,4,4,6,7,4,5,7,6,5,4,6,9,6,9,7,10,7,10,0,11,0,12,1,12,1,11,0,5,1,1,4,4,0,0,5,1,12]),y=x.length;j.dancing?w[x[j.bar%y]]():v(),j.bar++}}};e.prototype={},"undefined"==typeof a.jp&&(a.jp={}),"undefined"==typeof a.jp.mi73&&(a.jp.mi73={}),a.jp.mi73.egg=new e}(window,document,jQuery,THREE);