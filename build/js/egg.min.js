/*! jp.mi73.egg 2014-01-31 */
!function(a,b,c,d){"use strict";var e=function(){var e,f="easeInOutQuart",g=+new Date,h=6e4,i=!1;this.init=function(){function j(){requestAnimationFrame(j),k.particleMaterial.uniforms.time.value=(+new Date-g)/1e3,E.update(),k.renderer.render(k.scene,k.camera)}var k=this;this.renderer=new d.WebGLRenderer({antialias:!0}),this.renderer.setSize(a.innerWidth,a.innerHeight),this.renderer.setClearColorHex(0,1),this.renderer.shadowMapEnabled=!0,c(a).on("resize",function(){k.renderer.setSize(a.innerWidth,a.innerHeight)}),b.getElementById("canvas-frame").appendChild(this.renderer.domElement);var l=60,m=window.innerWidth/window.innerHeight,n=.1,o=1e4;this.camera=new d.PerspectiveCamera(l,m,n,o),this.camera.position=new d.Vector3(170,0,10),this.camera.up=new d.Vector3(1,0,1),this.scene=new d.Scene,this.scene.add(this.camera);var p=new d.SpotLight(16777215);p.position.set(150,150,300),p.target.position.set(0,0,0),p.castShadow=!0,this.scene.add(p);var q=new d.SpotLight(16777215);q.position.set(100,-150,300),q.target.position.set(0,0,0),q.castShadow=!0;var r=new d.SpotLight(16777215);r.position.set(150,500,300),r.target.position.set(0,0,0),r.castShadow=!0;var s=new d.SpotLight(16777215);s.position.set(100,-500,300),s.target.position.set(0,0,0),s.castShadow=!0;var t=new d.AmbientLight(1052688);this.scene.add(t);var u=new d.MeshPhongMaterial({color:16777215,specular:16777215,shininess:1e3,shading:d.SmoothShading,side:d.DoubleSide}),v=new d.PlaneGeometry(1e4,1e5,200,200);this.ground=new d.Mesh(v,u),this.ground.position.z=-40,this.ground.receiveShadow=!0,this.ground.visible=!1,this.scene.add(this.ground),this.eggPoints=[];for(var w,x,y=40,z=0;180>=z;z++)w=Math.PI*z/180,x=new d.Vector3(0,y*(.72+.08*Math.cos(w))*Math.sin(w),-y*Math.cos(w)),this.eggPoints.push(x);this.eggGeometry=new d.LatheGeometry(this.eggPoints,100),this.eggGeometry.dynamic=!0,this.eggMaterial=new d.MeshPhongMaterial({color:16756849,shininess:50,shading:d.SmoothShading,wireframe:!0}),this.egg=new d.Mesh(this.eggGeometry,this.eggMaterial),this.egg.matrixWorldNeedsUpdate=!0,this.egg.updateMatrixWorld(),this.egg.position.set(.1,.1,.1),this.egg.castShadow=!0,this.dotsPoints=new d.Object3D;var A=new d.MeshBasicMaterial({color:16777215,transparent:!1});this.scene.add(this.dotsPoints),this.particleGeometry=new d.Geometry,this.particleMaterial=new d.ShaderMaterial({vertexShader:document.getElementById("vshader").textContent,fragmentShader:document.getElementById("fshader").textContent,uniforms:{time:{type:"f",value:0},size:{type:"f",value:.13},color:{type:"c",value:new d.Color(16756849)},texture:{type:"t",value:d.ImageUtils.loadTexture("img/particle.png")}},attributes:{lifetime:{type:"f",value:[]},shift:{type:"f",value:[]}},blending:d.AdditiveBlending,transparent:!0,depthTest:!1});for(var z=0;h>z;z++){var w=2*Math.random()*Math.PI,B=y*(.72+.08*Math.cos(w))*Math.sin(w),C=Math.random()*Math.PI,D=new d.Vector3(Math.sin(C)*B,Math.cos(C)*B,-y*Math.cos(w));D.velocity={x:Math.sin(C)*B/y*5,y:Math.cos(C)*B/y*5,z:5*-Math.cos(w)},this.particleMaterial.attributes.lifetime.value.push(3+Math.random()),this.particleMaterial.attributes.shift.value.push(Math.random()),this.particleGeometry.vertices.push(D)}this.particleGeometry.verticesNeedUpdate=!0,this.particle=new d.ParticleSystem(this.particleGeometry,this.particleMaterial),this.particle.position=new d.Vector3(0,0,0),this.particle.sortParticles=!1,this.particle.visible=!1,this.scene.add(this.particle);var E=new d.TrackballControls(this.camera);E.keys=[65,83,68],E.noRotate=!1,E.noZoom=!1,E.noPan=!1,this.controls=E,j(),this.drawEggPoint=function(){var a=0,b=function(){if(a%5===0){var c=new d.SphereGeometry(.5),e=new d.Mesh(c,A);e.position=k.eggPoints[a],k.dotsPoints.add(e),k.renderer.render(k.scene,k.camera)}a++,180>=a&&requestAnimationFrame(b)};b()},this.spinCurve=function(){var a=0,b=0,c=function(){k.dotsPoints&&(k.dotsPoints.rotateZ(b),k.renderer.render(k.scene,k.camera),a++,b+=.001,requestAnimationFrame(c))};c()},this.autoPan=function(){var a=i?1200*Math.random():200*Math.random()+200,b=Math.random()*Math.PI*2,c=i?500*Math.random()-60:200*Math.random()-40;this.panTo({x:a*Math.sin(b),y:a*Math.cos(b),z:c})},this.panTo=function(a){var b,e=this,f=0,g=200,h="easeOutQuart",i={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},j=function(){f++,b=c.easing[h](0,f,0,1,g),e.camera.position=new d.Vector3(i.x*(1-b)+a.x*b,i.y*(1-b)+a.y*b,i.z*(1-b)+a.z*b),e.camera.up=new d.Vector3(0,0,1e4),g>f&&requestAnimationFrame(j)};j()},this.addEggPoints=function(){for(var a,b,c,e=new d.SphereGeometry(.5),f=new d.Mesh(e,A),g=1;6>g;g++)for(var h=0;180>=h;h++)h%5===0&&(b=g/6*2*Math.PI,c=Math.PI*h/180,a=y*(.72+.08*Math.cos(c))*Math.sin(c),f=new d.Mesh(e,A),x=new d.Vector3(a*Math.sin(b),a*Math.cos(b),-y*Math.cos(c)),f.position=x,k.dotsPoints.add(f),k.renderer.render(k.scene,k.camera))},this.fallOutPoints=function(){var a=0,b=100,d=function(){var g=c.easing[f](0,a,0,4e3,b);a!==b?(requestAnimationFrame(d),k.dotsPoints.position.z=-g,a++):e()},e=function(){k.scene.remove(k.dotsPoints),delete k.dotsPoints};k.dotsPoints&&d()},this.animateEggWire=function(){var a=2,b=100,d=function(){k.showEggWire(a),a*=2,b>=a&&setTimeout(c.proxy(d,this),300)};d()},this.showEggWire=function(a){k.scene.remove(k.egg),delete k.egg,k.eggGeometry=new d.LatheGeometry(k.eggPoints,a),k.egg=new d.Mesh(k.eggGeometry,k.eggMaterial),k.egg.matrixWorldNeedsUpdate=!0,k.egg.updateMatrixWorld(),k.egg.position.set(0,0,0),k.egg.castShadow=!0,k.scene.add(k.egg)},this.offWireframe=function(){k.egg.material.wireframe=!1},this.applyMap=function(){k.scene.remove(k.egg),delete k.egg,delete k.eggGeometry,delete k.eggMaterial,k.eggGeometry=new d.LatheGeometry(k.eggPoints,100),k.eggMaterial=new d.MeshPhongMaterial({color:16756849,shininess:50,map:d.ImageUtils.loadTexture("img/egg.jpg"),shading:d.SmoothShading}),k.egg=new d.Mesh(k.eggGeometry,k.eggMaterial),k.egg.castShadow=!0,k.scene.add(k.egg)},this.explode=function(){var a=function(){for(var b=k.particleGeometry.vertices.length;b--;){var c=k.particleGeometry.vertices[b];c.x+=c.velocity.x,c.y+=c.velocity.y,c.velocity.z-=.1,c.z+=c.velocity.z,c.z<=-39&&(c.velocity.x*=.9,c.velocity.y*=.9,c.velocity.z=.7*-c.velocity.z,c.z=-39),k.ground.position.z-=10}k.particleGeometry.verticesNeedUpdate=!0,requestAnimationFrame(a)};k.particle.visible=!0,k.egg.visible=!1,i=!0,a()},this.appearGround=function(){var a=0,b=250,d="easeOutQuart",e=function(){var f=c.easing[d](0,a,0,1,b);k.ground.position.z=-4e3+3960*f,a++,a!==b?requestAnimationFrame(e):k.ground.position.z=-40};k.ground.position.z=-4e3,k.ground.visible=!0,e()},this.move=function(){var a=0,b=function(){var c=15*a/300;k.egg.rotation.x=.1*Math.sin(Math.PI*c),k.egg.position.y=-5*Math.sin(Math.PI*c),a++,300>=a&&requestAnimationFrame(b)};b()},this.jump=function(){var a=20,b=0,c=function(){b+=a,0>=b&&(a=.7*-a,b=0),k.egg.position.z=b,a-=.5,k.renderer.render(k.scene,k.camera),requestAnimationFrame(c)};c()},this.startAutoPan=function(){c(a).on("mousemove",function(){clearInterval(e),e=setInterval(c.proxy(k.autoPan,k),5e3)})},this.bar=0,this.dancing=!0,this.startDancing=function(){k.dancing=!0,k.dance()},this.stopDancing=function(){k.dancing=!1},this.dance=function(){var a=0,b=160,d=3600/b,e=0,f=100,g=(k.egg.position.x>f,k.egg.position.x<-f,k.egg.position.y>f,k.egg.position.y<-f,function(){if(0===a&&k.egg.position.x<-f)return console.log("ignore"),requestAnimationFrame(h);var b=Math.sin(2*Math.PI*a/d);k.egg.position.z=6*Math.abs(b),k.egg.rotation.x=-b/5,k.egg.position.x-=1,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:g)}),h=function(){if(0===a&&k.egg.position.x>f)return console.log("ignore"),requestAnimationFrame(g);var b=Math.sin(2*Math.PI*a/d);k.egg.position.z=6*Math.abs(b),k.egg.rotation.x=b/5,k.egg.position.x+=1,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:h)},i=function(){if(0===a&&k.egg.position.y>f)return console.log("ignore"),requestAnimationFrame(j);var b=Math.sin(2*Math.PI*a/d);k.egg.position.z=6*Math.abs(b),k.egg.rotation.y=b/5,k.egg.position.y+=1,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:i)},j=function(){if(0===a&&k.egg.position.y<-f)return console.log("ignore"),requestAnimationFrame(i);var b=Math.sin(2*Math.PI*a/d);k.egg.position.z=6*Math.abs(b),k.egg.rotation.y=b/5,k.egg.position.y-=1,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:j)},l=function(){if(0===a&&k.egg.position.y>f)return console.log("ignore"),requestAnimationFrame(m);var b=c.easing.easeOutQuart(0,a,0,50,d);k.egg.position.z=0,k.egg.position.y+=b-e,k.egg.rotation.x=b-e,e=b,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:l)},m=function(){if(0===a&&k.egg.position.y<-f)return console.log("ignore"),requestAnimationFrame(l);var b=c.easing.easeOutQuart(0,a,0,50,d);k.egg.position.z=0,k.egg.position.y-=b-e,k.egg.rotation.x=-b+e,e=b,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:m)},n=function(){if(0===a&&k.egg.position.x<-f)return requestAnimationFrame(o);var b=c.easing.easeOutQuart(0,a,0,50,d);k.egg.position.z=0,k.egg.position.x-=b-e,k.egg.rotation.y=b-e,e=b,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:n)},o=function(){if(0===a&&k.egg.position.x>f)return console.log("ignore"),requestAnimationFrame(n);var b=c.easing.easeOutQuart(0,a,0,50,d);k.egg.position.z=0,k.egg.position.x+=b-e,k.egg.rotation.y=-b+e,e=b,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:o)},p=function(){var b=a/d;k.egg.rotation.x=2*Math.PI*b,k.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:p)},q=function(){var b=a/d;k.egg.rotation.x=4*Math.PI*b,k.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:q)},r=function(){var b=a/d;k.egg.rotation.x=2*-Math.PI*b,k.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:r)},s=function(){var b=a/d;k.egg.rotation.x=4*-Math.PI*b,k.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:s)},t=function(){var b=a/d;k.egg.rotation.y=2*-Math.PI*b,k.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:t)},u=function(){var b=a/d;k.egg.rotation.y=4*-Math.PI*b,k.egg.position.z=(-(a-d/2)*(a-d/2)+d*d/4)/8,a++,k.renderer.render(k.scene,k.camera),requestAnimationFrame(a>=d?k.dance:u)},v=function(){var b=a/d,c=Math.sin(2*Math.PI*a/d);k.egg.rotation.x=c/5,k.egg.rotation.y=c/5,k.egg.rotation.z=c/5,k.egg.position.x*=1-b,k.egg.position.y*=1-b,k.egg.position.z*=1-b,a++,k.renderer.render(k.scene,k.camera),a>=d?(k.egg.position.x=0,k.egg.position.y=0,k.egg.position.z=0):requestAnimationFrame(v)},w=[g,h,i,j,l,m,n,o,p,r,q,s,t,u],x=(Math.floor(12*Math.random()),[0,0,1,1,2,3,3,2,4,4,8,8,8,8,5,5,5,5,9,9,9,9,4,4,6,7,4,5,7,6,5,4,6,9,6,9,7,10,7,10,0,11,0,12,1,12,1,11,0,5,1,1,4,4,0,0,5,1,12]),y=x.length;k.dancing?w[x[k.bar%y]]():v(),k.bar++}}};e.prototype={},"undefined"==typeof a.jp&&(a.jp={}),"undefined"==typeof a.jp.mi73&&(a.jp.mi73={}),a.jp.mi73.egg=new e}(window,document,jQuery,THREE);